{% extends "base.html" %}

{% load filters %}

{% block content %}  
{% if sim_list %}   
<div id ='innerContent'>
    {% include "content.html" %} <!-- html + js files. The content of the table which is reloaded after each post/get request-->
</div> 
    {% include "set_tag.html" %}           <!-- 'set tags for selected records' window -->
    {% include "settings_window.html" %}   <!-- 'settings' popup window -->
    {% include "new_record.html" %}        <!-- 'new record' popup window -->
    {% include "delete_record.html" %}     <!-- 'delete selected records' popup window -->
    {% include "comparison_window.html" %} <!-- 'compare selected records' popup window -->
<script type = 'text/javascript'>
$(document).ready(function(){ 
    // initialization of all modal popup-windows (settings, new record, set tags, compare records) and hide them
    $('.modal').modal().modal('hide');

    $('#tags-b').tooltip({
        title: 'Tags',
        placement: 'bottom',
        trigger: 'hover'
    });

    // search input textarea
    $('#search_subnav').val('');

    // click on the button 'tags' on the header
    $('#tags-b').click(function(){
        $.ajax({
            type: 'GET',
            url: '/{{project_name}}/tag/',
            success:function(data){
                $('#dropdown_tags').html(data); // refresh the drop-down with the list of tags
            }
        });
    });

    $('.menu-tags').live('click', function(){ // using live() because it was inserted dynamycally using django
        var $tags = $(this).html();
        $('#search_subnav').val('tags: ' + $tags);
        obj = {};
        obj['tags'] = $tags;
        $.ajax({
            type: 'POST',
            url: '/{{project_name}}/tag/',
            data: {search_input: obj},
            success:function(data){
                $('#main_content').html(data); // refresh the drop-down with the list of tags
            }
        });
    });

    //deselection of the records when clicking some place on the page
    //all the records will be deselected except when the modal pop up window is clicked
    $(window).click(function(e){               // each time user clicks the window
        if (e.target.type !== 'checkbox'){ // delete_record.html: has a checkbox and we don't want to deselect all records when clicking this checkbox
                $('.record').removeClass('ui-selected'); // removing all selected records
                $('#selection_header').css('display', 'none'); // remove the header of the table when there are some selected records
                $('#default_header').css('display', 'inline'); // append the default header of the table
        };       
    });

    // hide the scroll when modal popup is open
    $('.modal').on('hide', function(){
        $('body').css('overflow', 'auto');
    }).on('show', function(){
        $('body').css('overflow', 'hidden');
    });
});
</script>
{% else %}
<div style='text-align: center;'>
    <div style='font-size:40px; padding:50px 15px;'>You don't have any records yet</div>
    {% include "new_record.html" %}
    <a id='btn_newrec' class='btn btn-danger btn-large' style='font-size:30px; width:30%; margin-top:70px'>
        <i class="icon-file"></i> New record
    </a>
</div> 
<script type = 'text/javascript'>

$(document).ready(function(){ 
    $('#btn_run').click(function(){
        $('div.progress').animateBar('start');
        var $mainFile = $('#select-main').next().find('span').html();
        var $argsFile = $('#select-arg').next().find('span').html();
        $.ajax({
            type: 'POST',
            url: '/{{project_name}}/simulation',
            async: true,
            data:  {'label':$('#mLabel').val(),
                     'reason':$('#mReason').val(),
                     'tag':$('#mTag').val(),
                     'execut':$('#mExec').val(),
                     'main_file':$mainFile,
                     'args':$argsFile},
            success: function(){
                success = true;
                $.jGrowl('Success',{
                  theme:  'success',
                  position:  'bottom-left'});
                  window.open(document.URL, '_self');
            }
        });
    });
});
</script>
{% endif %}
{% endblock %}