{% extends "base.html" %}

{% load filters %}

{% block header %} 
    {% include "header.html" %}
{% endblock %}

{% block content %} 
<div id ='innerContent'>
    {% include "content.html" %}       <!-- the content of the table + paginator header + some javascript -->
</div> 
    {% include "set_tag.html" %}           <!-- 'set tags for selected records' window -->
    {% include "settings_window.html" %}   <!-- 'settings' popup window -->
    {% include "new_record.html" %}        <!-- 'new record' popup window -->
    {% include "delete_record.html" %}     <!-- 'delete selected records' popup window -->
    {% include "comparison_window.html" %} <!-- 'compare selected records' popup window -->
<script type = 'text/javascript'>
$(document).ready(function(){ 
    // initialization of all modal popup-windows (settings, new record, set tags, compare records) and hide them
    $('.modal').modal().modal('hide');

    /* 1. Search form */
    // initialization of jquery-ui datepicker used in the seach drop-down list
    $( "#id_timestamp, #id_datewithin" ).datepicker();

    // initialization of the drop-down search list (#div_menu_search)
    $('#div_menu_search').offset({left: $('#text_subnav').offset().left + 20}); // x-position as for the #text_subnav + 20px
    $('#icon_cdown').click(function(event){   
        var parentWidth = $('input.span5')[0].offsetWidth - 2; // the width of this drop-down equals the width of #text_subnav
        $('#menu_search').css('width', parentWidth).show();
    });
    // user can close the drop-down search list by clicking on the window or by clicking #close_menu (little icon top-right side)
    $('#close_menu, html').click(function() {
        $('#menu_search').hide();
    });
    // prevent closing the drop-down search list when clicking on it
    $('#menu_search, #icon_cdown, #ui-datepicker-div').click(function(event){
        event.stopPropagation(); 
        $('#menu_datewith').hide();
        return false; 
    });

    // clearing of the search form fields
    $('#search_form').find(':input').each(function() {
         $(this).val('');
    });

    // as soon as user clicks the search button in the search drop-down list, the form will be submited
    $('#search_but').click(function(){
        $('#main_content').load('search',{executable:$('#id_executable').val(), repository:$('#id_repository').val(), tags:$('#id_tags').val(), main_file:$('#id_main_file').val(), label:$('#id_label').val(), script_arguments:$('#id_script_arguments').val(), reason:$('#id_reason').val(), timestamp:$('#id_timestamp').val(), date_interval: $('#sdate').html(), date_interval_from: $('#id_datewithin').val()});
    });

    // "date within" plugin (search form)
    $('#menu_datewith > li').click(function(){
        $('#menu_datewith').hide();
        $('#sdate').text($(this).text());       
    });
    $('#idatewith, #up_icon, #low_icon').click(function(event){
        event.stopPropagation(); 
        $('#menu_datewith').show();
        $('#menu_datewith').offset({left: $('#idatewith').offset().left});
    });
});
</script>
{% endblock %}