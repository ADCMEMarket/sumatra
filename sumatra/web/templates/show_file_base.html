{% extends "base.html" %}

{% load filters %}

{% block title %}{{project_name}}: {{label}}: {{path}}{% endblock %}

{% block header %}
            <li class="divider"></li>
            <li><a href="/{{project_name}}/">{{project_name}}</a></li>
            <li><a href="/{{project_name}}/{{path}}/">
                {{path}}</a></li> <!--?? What are the urls? -->
{% endblock %}

{% block content %}

<!--<h3>{{path}}</h3>-->

<!--{% if mimetype %}
<p>Mimetype: {{mimetype}}
{% endif %}-->



  <div class="accordion">
    <h2 class="nav-toggle">General info</h2>
    <form action='{{ request.path }}' method='POST' 
          id="actions" name="actions">
      {{form.errors}}
      <fieldset class = 'field-acc'>
        <fieldset class = 'field-acc'>
          <div class="control-group">
            <table id = 'gen_info'>
              <tr><th>Path:</th><td>{{path}}</td></tr>
              <tr><th>Type:</th><td>{{mimetype}}</td></tr>
              <tr><th>Size:</th><td>{{metadata.size|filesizeformat}}</td></tr>
              <tr><th>Timestamp: </th><td>{{time|date:"d/m/Y H:i:s"}}</td></tr>
              <tr><th>Description:</th><td>{{form.description}}</td></tr>
            </table>
          </div>
        </fieldset>
    </form>
  </div>



   <div class="accordion">
    <h2 class="nav-toggle">Associated Data (Siblings)</h2>
    <form action='{{ request.path }}' method='POST' 
          id="actions" name="actions">
      {{form.errors}}
      <fieldset class = 'field-acc'>
        <fieldset class = 'field-acc'>
          <div class="control-group">

          </div>
        </fieldset>
    </form>
  </div>



  <div class="accordion">
    <h2 class="nav-toggle">Associated Records (Provenance)</h2>
    <form action='{{ request.path }}' method='POST' 
          id="actions" name="actions">
      {{form.errors}}
      <fieldset class = 'field-acc'>
        <fieldset class = 'field-acc'>
          <div class="control-group">

            <br/>

            <table class='record_table compact' id='ol-content'>

              {% for record in input_records %}

              <tr class='record_tr'>     


                <!--<td id = 'version-hid' class='d-hid'> 
                  {{record.version}}
                </td>
                <td id = 'repo-hid' class='d-hid'>
                  {{record.repository.url}}
                </td> 

                to be hidden. what do they do?

                -->
   
                <td class='record_td' id='repository-t'>
                  <span class="span-box">
                    {{record.repository.url|cut:"repo"}}
                  </span>
                </td>
                <td class='record_td' id='label-t'>
                  <a href="/{{project_name}}/{{record.label}}/">
                    {{record.label}}
                  </a> 
  
                </td> 
                {% if tag %}
                  <td class='record_td' id='tag-t'>
                    {% for other_tag in record.tag_objects %}
                    {% if tag == other_tag %}
                      {{tag}} 
                    {% else %}
                      <a href="#">
                        {{other_tag.name}}
                      </a> <!-- Fix Link!! -->
                    {% endif %}
                    {% endfor %}
                  </td>
                {% else %}
                  <td class='record_td' id='tag-t'>
                    {% for tag in record.tag_objects %}
                      <a href="#">{{tag}}</a>, <!-- Fix Link!! -->
                    {% endfor %}
                  </td> 
                {% endif %}

                <td class='record_td' id='reason-t'>
                  {{record.reason}}
                </td>
                <td class='record_td' id='outcome-t'>
                  {{record.outcome}}
                </td>
                <td class='record_td' id='duration-t'>
                  {{record.duration|human_readable_duration}}
                </td>
                <td class='record_td' id='processes-t'>
                  {{record.launch_mode.get_parameters.n|default:"1"}}
                </td>
                <td class='record_td' id='date-t'>
                  {{record.timestamp|date:"d/m/Y"}}
                </td>
                <td class='record_td' id='time-t'>
                  {{record.timestamp|date:"H:i:s"}}
                </td>
                <td class='record_td' id='ename-t'>
                  {{record.executable.name}}
                </td>
                <td class='record_td' id='eversion-t'>
                  {{record.executable.version}}
                </td>
                <td class='record_td' id='main-t'>
                  <a class='id-script'  data-toggle="modal" href="#">
                    {{record.main_file}}
                  </a> <!-- Fix Link!! -->
                </td>
                <td class='record_td' id='version-t'>
                  <span class="span-box">
                    {{record.version|cut:"vers"}}
                    {% if record.diff %}
                      *
                    {% endif %}
                  </span>
                </td>
                <td class='record_td' id='arguments-t'>
                  <a class='href_args'
                     href='#'>
                    {{record.script_arguments}}
                  </a> <!-- Fix Link!! -->
                </td>     
              </tr>
              {% endfor %}
            </table>

            <br/>

            <!--<table class='record_table comfortable'>
              {% for record in input_records %}
              <tr class='record_tr' id='label-t'>                
                <td class='record_td'>
                  <a class='href_lab' href='#'>
                    {{record.label}}
                  </a>
                </td>
                <td class='record_td' id='script-t'>
                  <a class='id-script' data-toggle="modal" href="#">
                    {{record.main_file}}
                  </a>
                </td>         
              </tr>
              {% endfor %}
            </table>-->


            <!--{% for item in settings.hidden_cols %}
              l-{{item}}
              {{item}}-t
            {% endfor%} -->


          </div>
        </fieldset>
    </form>
  </div>




            <!--<table border="1px solid black">
              {% for record in input_records %}
              <tr>                
                <td>
                  <a class='href_lab' href='#'>
                    {{record.label}}
                  </a>
                </td>
                <td>
                  <a class='id-script' data-toggle="modal" href="#">
                    {{record.main_file}}
                  </a>
                </td>         
              </tr>
              {% endfor %}
            </table>-->




  <!-- <table id = 'gen_info'>
    <tr>
      <th> Ouput of: </th>
      <td>
        {% for record in output_records %}
        <a href="/{{project_name}}/{{record.label}}/"> 
          {{record.label}}</a> 
        {% endfor %}
      </td>
    </tr>
    
    <tr>
      <th>   Used as input in: </th>
      <td>
        {% for record in input_records %} 
        <a href="/{{project_name}}/{{record.label}}/"> 
          {{record.label}}</a>,
        {% endfor %}
      </td>
    </tr>    
  </table>-->



<!--<h4> Associated records: </h4>







<p>Output of:
  {% for record in output_records %}
  <a href="/{{project_name}}/{{record.label}}/"> 
    {{record.label}}</a> 
  {% endfor %} <br />

  Used as input in: 
  {% for record in input_records %} 
  <a href="/{{project_name}}/{{record.label}}/"> 
    {{record.label}}</a>, 
  {% endfor %}</p> 

<p>Size: {{metadata.size|filesizeformat}} <br />
   Time: {{time|date:"d/m/Y H:i:s"}}</p> -->

<script type="text/javascript" src="/media/js/sumatra.ajax.js"></script>  

<script type = 'text/javascript' src='/media/js/jquery-1.7.2.min.js'></script>
<script type = 'text/javascript'>
$(document).ready(function(){
        $('.accordion').find('h2').click(function(){
		    $(this).next().slideToggle();
		}).next()//.hide();
		$('#accordion-js').find('#additional').next().hide();
        $('#stdout').css('width', $('h2.topic').width());
});
</script>



<script type = 'text/javascript'>
$(document).ready(function(){ 
    // initialization of all modal popup-windows (settings, new record, set tags, compare records) and hide them
    $('.modal').modal().modal('hide');

    $('#tags-b').tooltip({
        title: 'Tags',
        placement: 'bottom',
        trigger: 'hover'
    });

    // search input textarea
    $('#search_subnav').val('');

    // click on the button 'tags' on the header
    $('#tags-b').click(function(){
        $.ajax({
            type: 'GET',
            url: '/{{project_name}}/tag/',
            success:function(data){
                $('#dropdown_tags').html(data); // refresh the drop-down with the list of tags
            }
        });
    });

    $('.menu-tags').live('click', function(){ // using live() because it was inserted dynamycally using django
        var $tags = $(this).html();
        $('#search_subnav').val('tags: ' + $tags);
        obj = {};
        obj['tags'] = $tags;
        $.ajax({
            type: 'POST',
            url: '/{{project_name}}/tag/',
            data: {search_input: obj},
            success:function(data){
                $('#main_content').html(data); // refresh the drop-down with the list of tags
            }
        });
    });

    //deselection of the records when clicking some place on the page
    //all the records will be deselected except when the modal pop up window is clicked
    $(window).click(function(e){               // each time user clicks the window
        if (e.target.type !== 'checkbox'){ // delete_record.html: has a checkbox and we don't want to deselect all records when clicking this checkbox
                $('.record').removeClass('ui-selected'); // removing all selected records
                $('#selection_header').css('display', 'none'); // remove the header of the table when there are some selected records
                $('#default_header').css('display', 'inline'); // append the default header of the table
        };       
    });

    // hide the scroll when modal popup is open
    $('.modal').on('hide', function(){
        $('body').css('overflow', 'auto');
    }).on('show', function(){
        $('body').css('overflow', 'hidden');
    });
});
</script>

{% endblock %}



